

#This is the default config of the rsnapshot-docker-compose-backup program.
#This section can contain rsnapshot commands that are executed in the different steps of the container backup

[default_config]
#Example:
#run_backup=backup_script   echo "Hello" > helloWorld   test/

#This section contains settings that are used by the backup
[default_config.settings]
#This setting corresponds to the var with the same name and can be used as a prefix in the folder path

[default_config.vars]
backupPrefixFolder = .
backupFolder = /mnt/backup

[default_config.actions]
stopcontainer = true
volumebackup = true
yamlbackup = false
projectDirBackup = true
imagebackup = true


#The following is the definition of actions that can be used in the backup
[actions.volumeBackup]
backup = backup	$backupFolder	$backupPrefixFolder/$serviceName/$volumes.name

[actions.yamlBackup]
runtime_backup = backup	$backupFolder$projectFolder	$backupPrefixFolder/$serviceName/yaml	+rsync_long_args=--include=*.yml,+rsync_long_args=--include=*.yaml

[actions.projectDirBackup]
backup = backup	$backupFolder$projectFolder	$backupPrefixFolder/$serviceName/projectDir

[actions.imageBackup]
runtime_backup = backup_exec	/bin/mkdir $tmpFolder; /usr/bin/docker image save $image -o $tmpFolder/$serviceName_image.tar
	backup	$backupFolder$tmpFolder	$backupPrefixFolder/$serviceName/image
	backup_exec	/bin/rm -rf $tmpFolder

[actions.logBackup]
backup = backup_exec	/bin/mkdir $tmpFolder; /usr/bin/docker logs $containerID &> $tmpFolder/$serviceName_logs.log
	backup	$backupFolder$tmpFolder	$backupPrefixFolder/$serviceName/log
	backup_exec	/bin/rm -rf $tmpFolder

[actions.stopContainer]
stop = backup_exec	cd $projectFolder; /usr/bin/docker compose --ansi never stop
restart = backup_exec	cd $projectFolder; /usr/bin/docker compose --ansi never start
